name: golang-echo
version: "0.1"
language: golang
type: api
about: A golang Echo webframework dsl

# Need to be careful about not colliding with
# any other pkg, cli, api
# however the user has control over these
# settings anyhow, so perhaps just need to detect

#build-pipeline:
#  stages:
#    - name: generate dependent yaml
#      cmd: "geb gen ...? (specific dirs and output files)"
#    # possible remove with deps
#    - name: generate types
#      cmd: "geb gen -gen type/golang ???"
#    - name: generate library
#      cmd: "geb gen -gen pkg/golang ???"
#    # stop possible remove with deps
#    - name: generate api
#      cmd: "geb gen -gen api/golang/echo"
#    # possible remove with deps
#    - name: generate js-client
#      cmd: "geb gen -G client/js"
#    - name: generate cli
#      cmd: "geb gen cli"
#    # stop possible remove with deps

# build-pipeline with deps below
build-pipeline:
  stages:
    # - name: generate dependent yaml
    #   cmd: "geb gen ...? (specific dirs and output files)"
    - name: generate api
      cmd: "geb gen -gen api/golang/echo"

# How to deal with package and user-defined, but used dsl
# e.x. pkg is used in binding for api, cli, client
dependencies:
  design-templates:
    - dsl: cli
      data: "."
      in: cli.yaml
      out: cli.yaml
    - dsl: client
      data: "."
      in: client.yaml
      out: client.yaml
  generators:
    - type/golang # include? (probably doesn't hurt)
    - pkg/golang  # include? (probably doesn't hurt)
    - cli/golang
    - client/golang
    - client/js

template-configs:

  - name: root
    field: "."
    templates:
      - in: "main.go"
        out: "main.go"
      - in: "setupRoutes.go"
        out: "setupRoutes.go"
      - in: "config.yaml"
        out: "config.yaml"
      - when: routes
        in: "log.go"
        out: "routes/log.go"
      - when: resources
        in: "log.go"
        out: "resources/log.go"

  - name: route
    field: routes
    templates:
      - in: "route.go"
        out: "routes/{{camel name}}.go"
      - when: routes
        in: "log.go"
        out: "routes/{{name}}/log.go"

  - name: sub-route
    field: routes.[:].routes
    templates:
      - in: "route.go"
        out: "routes/{{parent}}/{{camel name}}.go"
      - when: routes
        in: "log.go"
        out: "routes/{{parent}}/{{name}}/log.go"

  - name: subsub-route
    field: routes.[:].routes.[:].routes
    templates:
      - in: "route.go"
        out: "routes/{{getbetween CTX.pkgPath '/' '/'}}/{{parent}}/{{camel name}}.go"


  - name: resource
    field: resources
    templates:
      - in: "resource.go"
        out: "resources/{{camel name}}.go"
      - when: resources
        in: "log.go"
        out: "resources/{{name}}/log.go"

  - name: sub-resource
    field: resources.[:].resources
    templates:
      - in: "resource.go"
        out: "resources/{{parent}}/{{camel name}}.go"
      - when: resources
        in: "log.go"
        out: "resources/{{parent}}/{{camel name}}/log.go"

  - name: subsub-resource
    field: resources.[:].resources.[:].resources
    templates:
      - in: "resource.go"
        out: "resources/{{getbetween pkgPath '/' '/'}}/{{camel name}}.go"



