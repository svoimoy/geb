name: golang-echo
version: "0.1"
language: golang
type: api
about: A golang Echo webframework dsl

# How to deal with package and user-defined, but used dsl
# e.x. pkg is used in binding for api, cli, client
dependencies:
  designs:
    - name: root
      field: "."
      templates:
        - in: lib/db-ops/pkg.yaml
          out: lib/db-ops/pkg.yaml
        - in: lib/tools/db-ops/cli.yaml
          out: lib/tools/db-ops/cli.yaml
        - in: lib/tools/data-ops/cli.yaml
          out: lib/tools/data-ops/cli.yaml
        - in: client/sdk/pkg.yaml
          out: client/sdk/pkg.yaml
        - in: client/js/pkg.yaml
          out: client/js/pkg.yaml
        - in: client/cli/cli.yaml
          out: "client/{{name}}-cli/cli.yaml"

  generators:
    - dsl: common
      gen:
        - golang
      output-dir: "."
    - dsl: type
      gen:
        - golang
      output-dir: "."
    - dsl: pkg
      gen:
        - golang
      output-dir: "."
    - dsl: cli
      gen:
        - golang
      output-dir: "."

template-configs:

  - name: root
    field: "."
    templates:
      - in: "main.go"
        out: "main.go"
      - in: "setupRoutes.go"
        out: "setupRoutes.go"
      - in: "config.yaml"
        out: "config.yaml"
      - when: routes
        in: "log.go"
        out: "routes/log.go"
      - when: resources
        in: "log.go"
        out: "resources/log.go"
      - when: "databases.[type==postgres]"
        in: "setupPostgres.go"
        out: "databases/setupPostgres.go"

  - name: databases
    field: databases
    templates:
      - in: "log.go"
        out: "databases/log.go"

  - name: route
    field: routes
    templates:
      - in: "route.go"
        out: "routes/{{camel name}}.go"
      - when: routes
        in: "log.go"
        out: "routes/{{name}}/log.go"

  - name: sub-route
    field: routes.[:].routes
    templates:
      - in: "route.go"
        out: "routes/{{parent}}/{{camel name}}.go"
      - when: routes
        in: "log.go"
        out: "routes/{{parent}}/{{name}}/log.go"

  - name: subsub-route
    field: routes.[:].routes.[:].routes
    flatten: 1
    templates:
      - in: "route.go"
        out: "routes/{{getbetween CTX.pkgPath '/' '/'}}/{{parent}}/{{camel name}}.go"


  - name: resource
    field: resources
    templates:
      - in: "resource.go"
        out: "resources/{{camel name}}.go"
      - when: resources
        in: "log.go"
        out: "resources/{{name}}/log.go"

  - name: sub-resource
    field: resources.[:].resources
    templates:
      - in: "resource.go"
        out: "resources/{{parent}}/{{camel name}}.go"
      - when: resources
        in: "log.go"
        out: "resources/{{parent}}/{{camel name}}/log.go"

  - name: subsub-resource
    field: resources.[:].resources.[:].resources
    flatten: 1
    templates:
      - in: "resource.go"
        out: "resources/{{getbetween pkgPath '/' '/'}}/{{camel name}}.go"



